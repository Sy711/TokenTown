# TokenTown
## ``

## 【产品需求文档 (PRD)】

---

## === 1️⃣ 产品概述 ===

### 1.1 概要

TokenTown 是一款基于 Sui 区块链的非回合制、双人对战、培养心理搅擦和策略组合的 Web3 游戏。结合卡牌堆叠与奖池博弈机制

用户在游戏中获取随机卡牌，抽取后经过策略果断和紧张操作，选择目标卡牌类型进行堆堆乐。付费抽卡堆叠数量，与对手进行不完全信息博弈，最终通过链上智能合约自动结算胜负并分配奖池。

### 1.2 目标用户

- Web3 玩家
- GameFi 中清级用户
- Web3 交易手机用户 / 钱包方法用户
- 想试玩基于链上小游戏的新手用户

### 1.3 主要优势

- 基于区块链，给予玩家全端可观可验证的公平性
- 非回合制、尽量策略式游戏模式，增强玩家互动性
- 单场战斗阶段短，適合快速体验
- 奖励模型明确，高性价比较感

---

## === 2️⃣ 特性和功能 ===

### 2.1 核心功能

- 快速抽卡分配 (2 次/免费，后续费用 0.2 SUI)
- 选择堆卡类型
- 同类型堆叠校验
- 提交比拍（先提交者需支付双倍 fee）
- 进行链上结算
- 房间创建/加入（0.5 SUI入场费）
- 背后 Redis 与 SWR 分配房间状态
- Claim 奖励

### 2.2 用户故事

- 作为一名新手，我需要快速理解奖池变化与对手行为的关联，避免盲目投入
- 作为一名高资本玩家，我选择先手提交，希望胜利全场
- 作为一名普通用户，我选择后提交，以输出最有效的卡牌组合
- **作为一名鲸鱼用户**：“我需要大额对战房间（奖池≥100 SUI）和定制化隐私保护功能。”

---

## === 3️⃣ 技术架构 ===

### 3.1 智能合约设计（在sui上的move）

### 核心结构

```
public struct Room has drop, store {
    rank: u64,
    players: vector<address>,
    status: u8, // 0=等待中 1=进行中 2=已结束
    winner: address,
    loser:address,
    winner_has_claim:bool,
    loser_has_claim:bool,

}
/// 全局大厅池（自动管理）
public struct RoomPool has key {
    id: UID,
    rank_index: u64,
    open_lobbies: VecMap<u64, Room>,
    entry_fees: Bag,
}
```

### 功能

- 房间创建、加入、结算、奖励分配
- 防止做弊（校验卡牌数量得出第一名与第二名）
- 结算后发出 Claim 事件，方便后端监听

### 3.2 堆叠卡牌

游戏开始后用户点击Delivery，随机发放30张卡牌至7个卡槽，卡牌类型控制在7个不同类型

示例：

1.卡槽2能拖拽顶部卡牌类型与卡槽1上的最顶部卡牌类型相同的卡牌组，相同类型的可一起拖拽

2.用户可从下方七个卡槽中最底部卡牌类型拖拽至目标卡牌类型区域，一旦拖拽成功即锁定卡牌类型，用户后续只能将该卡牌类型加入目标卡牌堆中。

3.其中一名用户点击提交后，两位玩家的目标卡牌堆锁定，传入链上

### 3.3 前端和钱包集成

- 基于 Next.js
- 使用 SWR 分配房间状态
- 与 Sui 钱包集成，支持发起合约操作
- 配合 Redis 做快速状态分配/区分属于房间

---

## === 4️⃣ 用户流程图 ===

- 登陆 → 点击匹配 → 等待对手 → 抽卡 → 选卡堆卡 → 提交 → 合约结算 → 各自 claim 奖励

---

## === 5️⃣ 货币化模式 ===

- 每场游戏入场费 0.5 SUI
- 二次免费抽卡后，后续抽卡需要每次 0.2 SUI

---

## === 6️⃣ 总结 ===

TokenTown 是一款简单、轻量级、成本可控而玩法充满心理操纵空间的 Web3 游戏。

本项目的首版 MVP 为高效率开发、简单可用为目标，通过双盲博弈模型，为玩家提供高复玩性体验。后续可逐步实现更多用户层面分级、市场化，打造基于 Sui 环境的优质社区玩法基地。
